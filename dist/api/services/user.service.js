"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _Cart = _interopRequireDefault(require("../../models/Cart"));
var _Product = _interopRequireDefault(require("../../models/Product"));
var _User = _interopRequireDefault(require("../../models/User"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
class UserService {
  async addToCart(uid, body) {
    const cart = await _Cart.default.create({
      ...body,
      user_id: uid
    });
    return cart;
  }
  async getCart(uid) {
    const carts = await _Cart.default.find({
      user_id: uid
    });
    for (let i = 0; i < carts.length; i++) {
      const product = await _Product.default.findById(carts[i].product_id);
      carts[i].product_details = product;
    }
    return carts;
  }
  async removeFromCart(uid, body) {
    const cart = await _Cart.default.findById(body.cart_id);
    if (cart.user_id == uid) {
      await _Cart.default.findByIdAndDelete(body.cart_id);
      return true;
    } else {
      return false;
    }
  }
  async addToWishList(uid, body) {
    const user = await _User.default.findByIdAndUpdate(uid, {
      $push: {
        wishlist: body.product_id
      }
    });
    return user;
  }
  async getWishlist(uid) {
    const user = await _User.default.findById(uid);
    const products = [];
    if (user.wishlist) {
      for (let i = 0; i < user.wishlist.length; i++) {
        const product = await _Product.default.findById(user.wishlist[i]);
        if (product) products.push(product);
      }
      return products;
    } else {
      return [];
    }
  }
  async removeWishlist(uid, product_id) {
    await _User.default.findByIdAndUpdate(uid, {
      $pull: {
        wishlist: product_id
      }
    });
    return {
      message: "Removed from wishlist"
    };
  }
  async moveTowishlist(uid, body) {
    const cart = await _Cart.default.findByIdAndDelete(body.cart_id);
    const user = await _User.default.findById(uid);
    if (cart) {
      for (let i = 0; i < user.wishlist.length; i++) {
        if (user.wishlist[i] == cart.product_id) {
          return {
            message: "Product already in wishlist"
          };
        }
      }
      user.wishlist.push(cart.product_id);
      await user.save();
      return {
        message: "Added in wishlist"
      };
    } else {
      return {
        message: "Cart not found"
      };
    }
  }
}
var _default = new UserService();
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVc2VyU2VydmljZSIsImFkZFRvQ2FydCIsInVpZCIsImJvZHkiLCJjYXJ0IiwiQ2FydCIsImNyZWF0ZSIsInVzZXJfaWQiLCJnZXRDYXJ0IiwiY2FydHMiLCJmaW5kIiwiaSIsImxlbmd0aCIsInByb2R1Y3QiLCJQcm9kdWN0IiwiZmluZEJ5SWQiLCJwcm9kdWN0X2lkIiwicHJvZHVjdF9kZXRhaWxzIiwicmVtb3ZlRnJvbUNhcnQiLCJjYXJ0X2lkIiwiZmluZEJ5SWRBbmREZWxldGUiLCJhZGRUb1dpc2hMaXN0IiwidXNlciIsIlVzZXIiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIiRwdXNoIiwid2lzaGxpc3QiLCJnZXRXaXNobGlzdCIsInByb2R1Y3RzIiwicHVzaCIsInJlbW92ZVdpc2hsaXN0IiwiJHB1bGwiLCJtZXNzYWdlIiwibW92ZVRvd2lzaGxpc3QiLCJzYXZlIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc2VydmVyL2FwaS9zZXJ2aWNlcy91c2VyLnNlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENhcnQgZnJvbSBcIi4uLy4uL21vZGVscy9DYXJ0XCI7XG5pbXBvcnQgUHJvZHVjdCBmcm9tIFwiLi4vLi4vbW9kZWxzL1Byb2R1Y3RcIjtcbmltcG9ydCBVc2VyIGZyb20gXCIuLi8uLi9tb2RlbHMvVXNlclwiO1xuXG5jbGFzcyBVc2VyU2VydmljZSB7XG4gIGFzeW5jIGFkZFRvQ2FydCh1aWQsIGJvZHkpIHtcbiAgICBjb25zdCBjYXJ0ID0gYXdhaXQgQ2FydC5jcmVhdGUoeyAuLi5ib2R5LCB1c2VyX2lkOiB1aWQgfSk7XG4gICAgcmV0dXJuIGNhcnQ7XG4gIH1cbiAgYXN5bmMgZ2V0Q2FydCh1aWQpIHtcbiAgICBjb25zdCBjYXJ0cyA9IGF3YWl0IENhcnQuZmluZCh7IHVzZXJfaWQ6IHVpZCB9KTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNhcnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBwcm9kdWN0ID0gYXdhaXQgUHJvZHVjdC5maW5kQnlJZChjYXJ0c1tpXS5wcm9kdWN0X2lkKTtcbiAgICAgIGNhcnRzW2ldLnByb2R1Y3RfZGV0YWlscyA9IHByb2R1Y3Q7XG4gICAgfVxuICAgIHJldHVybiBjYXJ0cztcbiAgfVxuICBhc3luYyByZW1vdmVGcm9tQ2FydCh1aWQsIGJvZHkpIHtcbiAgICBjb25zdCBjYXJ0ID0gYXdhaXQgQ2FydC5maW5kQnlJZChib2R5LmNhcnRfaWQpO1xuICAgIGlmIChjYXJ0LnVzZXJfaWQgPT0gdWlkKSB7XG4gICAgICBhd2FpdCBDYXJ0LmZpbmRCeUlkQW5kRGVsZXRlKGJvZHkuY2FydF9pZCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICBhc3luYyBhZGRUb1dpc2hMaXN0KHVpZCwgYm9keSkge1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkQW5kVXBkYXRlKHVpZCwge1xuICAgICAgJHB1c2g6IHsgd2lzaGxpc3Q6IGJvZHkucHJvZHVjdF9pZCB9LFxuICAgIH0pO1xuICAgIHJldHVybiB1c2VyO1xuICB9XG4gIGFzeW5jIGdldFdpc2hsaXN0KHVpZCkge1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHVpZCk7XG4gICAgY29uc3QgcHJvZHVjdHMgPSBbXTtcbiAgICBpZiAodXNlci53aXNobGlzdCkge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1c2VyLndpc2hsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBQcm9kdWN0LmZpbmRCeUlkKHVzZXIud2lzaGxpc3RbaV0pO1xuICAgICAgICBpZiAocHJvZHVjdCkgcHJvZHVjdHMucHVzaChwcm9kdWN0KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwcm9kdWN0cztcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuICBhc3luYyByZW1vdmVXaXNobGlzdCh1aWQsIHByb2R1Y3RfaWQpIHtcbiAgICBhd2FpdCBVc2VyLmZpbmRCeUlkQW5kVXBkYXRlKHVpZCwge1xuICAgICAgJHB1bGw6IHsgd2lzaGxpc3Q6IHByb2R1Y3RfaWQgfSxcbiAgICB9KTtcbiAgICByZXR1cm4geyBtZXNzYWdlOiBcIlJlbW92ZWQgZnJvbSB3aXNobGlzdFwiIH07XG4gIH1cbiAgYXN5bmMgbW92ZVRvd2lzaGxpc3QodWlkLCBib2R5KSB7XG4gICAgY29uc3QgY2FydCA9IGF3YWl0IENhcnQuZmluZEJ5SWRBbmREZWxldGUoYm9keS5jYXJ0X2lkKTtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZCh1aWQpO1xuICAgIGlmIChjYXJ0KSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHVzZXIud2lzaGxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKHVzZXIud2lzaGxpc3RbaV0gPT0gY2FydC5wcm9kdWN0X2lkKSB7XG4gICAgICAgICAgcmV0dXJuIHsgbWVzc2FnZTogXCJQcm9kdWN0IGFscmVhZHkgaW4gd2lzaGxpc3RcIiB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB1c2VyLndpc2hsaXN0LnB1c2goY2FydC5wcm9kdWN0X2lkKTtcblxuICAgICAgYXdhaXQgdXNlci5zYXZlKCk7XG4gICAgICByZXR1cm4geyBtZXNzYWdlOiBcIkFkZGVkIGluIHdpc2hsaXN0XCIgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHsgbWVzc2FnZTogXCJDYXJ0IG5vdCBmb3VuZFwiIH07XG4gICAgfVxuICB9XG59XG5leHBvcnQgZGVmYXVsdCBuZXcgVXNlclNlcnZpY2UoKTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQXFDO0FBRXJDLE1BQU1BLFdBQVcsQ0FBQztFQUNoQixNQUFNQyxTQUFTLENBQUNDLEdBQUcsRUFBRUMsSUFBSSxFQUFFO0lBQ3pCLE1BQU1DLElBQUksR0FBRyxN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